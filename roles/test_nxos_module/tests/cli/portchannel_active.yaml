---
- debug: msg="START cli/portchannel_active.yaml"

- name: ensure portchanel is configured with mode active
  nxos_portchannel:
    group: 11
    members: ['Ethernet1/6','Ethernet1/7']
    mode: 'active'
    host: "{{ inventory_hostname }}"
    state: present
    transport: cli
    username: admin
    password: "!cisco123!"
  register: data

- assert:
    that:
      - data.changed == true
      - data.end_state['mode'] == 'active'

- name: idempotency check
  nxos_portchannel:
    group: 11
    members: ['Ethernet1/6','Ethernet1/7']
    mode: 'active'
    host: "{{ inventory_hostname }}"
    state: present
    transport: cli
    username: admin
    password: "!cisco123!"
  register: data

- assert:
    that:
      - data.changed == false
      - data.end_state['mode'] == 'active'

- name: restore initial state
  nxos_portchannel:
    group: 11
    members: ['Ethernet1/6','Ethernet1/7']
    mode: 'active'
    host: "{{ inventory_hostname }}"
    state: absent
    transport: cli
    username: admin
    password: "!cisco123!"
  register: data
